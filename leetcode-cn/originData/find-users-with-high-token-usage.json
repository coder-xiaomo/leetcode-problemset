{
    "data": {
        "question": {
            "questionId": "4195",
            "questionFrontendId": "3793",
            "categoryTitle": "Database",
            "boundTopicId": 3871498,
            "title": "Find Users with High Token Usage",
            "titleSlug": "find-users-with-high-token-usage",
            "content": "<p>Table: <code>prompts</code></p>\n\n<pre>\n+-------------+---------+\n| Column Name | Type    |\n+-------------+---------+\n| user_id     | int     |\n| prompt      | varchar |\n| tokens      | int     |\n+-------------+---------+\n(user_id, prompt) is the primary key (unique value) for this table.\nEach row represents a prompt submitted by a user to an AI system along with the number of tokens consumed.\n</pre>\n\n<p>Write a solution to analyze <strong>AI prompt usage patterns</strong> based on the following requirements:</p>\n\n<ul>\n\t<li>For each user, calculate the <strong>total number of prompts</strong> they have submitted.</li>\n\t<li>For each user, calculate the <strong>average tokens used per prompt </strong>(Rounded to <code>2</code> decimal places).</li>\n\t<li>Only include users who have submitted <strong>at least </strong><code>3</code><strong> prompts</strong>.</li>\n\t<li>Only include users who have submitted <strong>at least one prompt</strong> with <code>tokens</code> <strong>greater than</strong> their own average token usage.</li>\n</ul>\n\n<p>Return <em>the result table ordered by <strong>average tokens</strong> in <strong>descending</strong> order, and then by <code>user_id</code> in <strong>ascending</strong> order.</em></p>\n\n<p>The result format is in the following example.</p>\n\n<p>&nbsp;</p>\n<p><strong class=\"example\">Example:</strong></p>\n\n<div class=\"example-block\">\n<p><strong>Input:</strong></p>\n\n<p>prompts table:</p>\n\n<pre class=\"example-io\">\n+---------+--------------------------+--------+\n| user_id | prompt                   | tokens |\n+---------+--------------------------+--------+\n| 1       | Write a blog outline     | 120    |\n| 1       | Generate SQL query       | 80     |\n| 1       | Summarize an article     | 200    |\n| 2       | Create resume bullet     | 60     |\n| 2       | Improve LinkedIn bio     | 70     |\n| 3       | Explain neural networks  | 300    |\n| 3       | Generate interview Q&amp;A   | 250    |\n| 3       | Write cover letter       | 180    |\n| 3       | Optimize Python code     | 220    |\n+---------+--------------------------+--------+\n</pre>\n\n<p><strong>Output:</strong></p>\n\n<pre class=\"example-io\">\n+---------+---------------+------------+\n| user_id | prompt_count  | avg_tokens |\n+---------+---------------+------------+\n| 3       | 4             | 237.5      |\n| 1       | 3             | 133.33     |\n+---------+---------------+------------+\n</pre>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n\t<li><strong>User 1</strong>:\n\n\t<ul>\n\t\t<li>Total prompts = 3</li>\n\t\t<li>Average tokens = (120 + 80 + 200) / 3 = 133.33</li>\n\t\t<li>Has a prompt with 200 tokens, which is greater than the average</li>\n\t\t<li>Included in the result</li>\n\t</ul>\n\t</li>\n\t<li><strong>User 2</strong>:\n\t<ul>\n\t\t<li>Total prompts = 2 (less than the required minimum)</li>\n\t\t<li>Excluded from the result</li>\n\t</ul>\n\t</li>\n\t<li><strong>User 3</strong>:\n\t<ul>\n\t\t<li>Total prompts = 4</li>\n\t\t<li>Average tokens = (300 + 250 + 180 + 220) / 4 = 237.5</li>\n\t\t<li>Has prompts with 300 and 250 tokens, both greater than the average</li>\n\t\t<li>Included in the result</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p>The Results table is ordered by avg_tokens in descending order, then by user_id in ascending order</p>\n</div>\n",
            "translatedTitle": "查找高词元使用量的用户",
            "translatedContent": "<p>表：<code>prompts</code></p>\n\n<pre>\n+-------------+---------+\n| Column Name | Type    |\n+-------------+---------+\n| user_id     | int     |\n| prompt      | varchar |\n| tokens      | int     |\n+-------------+---------+\n(user_id, prompt) 是这张表的主键（值互不相同）。\n每一行表示一个用户提交给 AI 系统的提示词以及所消耗的词元数量。\n</pre>\n\n<p>根据下列要求编写一个解决方案来分析 <strong>AI 提示词的使用模式</strong>：</p>\n\n<ul>\n\t<li>对每一个用户，计算他们提交的 <strong>提示词的总数</strong>。</li>\n\t<li>对每个用户，计算 <strong>每个提示词所使用的平均词元数</strong>（舍入到&nbsp;<code>2</code> 位小数）。</li>\n\t<li>仅包含&nbsp;<strong>至少提交了 <code>3</code> 个提示词</strong> 的用户。</li>\n\t<li>仅包含那些 <strong>至少提交过一个提示词</strong> 且其中的 <code>tokens</code> 数量 <strong>超过</strong> 自己平均词元使用量的用户。</li>\n</ul>\n\n<p>返回结果表按 <strong>平均词元数 降序</strong>&nbsp;排序，然后按<em>&nbsp;</em><code>user_id</code> <strong>升序</strong>&nbsp;排序。</p>\n\n<p>结果格式如下所示。</p>\n\n<p>&nbsp;</p>\n\n<p><strong class=\"example\">示例：</strong></p>\n\n<div class=\"example-block\">\n<p><strong>输入：</strong></p>\n\n<p>prompts 表：</p>\n\n<pre class=\"example-io\">\n+---------+--------------------------+--------+\n| user_id | prompt                   | tokens |\n+---------+--------------------------+--------+\n| 1       | Write a blog outline     | 120    |\n| 1       | Generate SQL query       | 80     |\n| 1       | Summarize an article     | 200    |\n| 2       | Create resume bullet     | 60     |\n| 2       | Improve LinkedIn bio     | 70     |\n| 3       | Explain neural networks  | 300    |\n| 3       | Generate interview Q&amp;A   | 250    |\n| 3       | Write cover letter       | 180    |\n| 3       | Optimize Python code     | 220    |\n+---------+--------------------------+--------+\n</pre>\n\n<p><strong>输出：</strong></p>\n\n<pre class=\"example-io\">\n+---------+---------------+------------+\n| user_id | prompt_count  | avg_tokens |\n+---------+---------------+------------+\n| 3       | 4             | 237.5      |\n| 1       | 3             | 133.33     |\n+---------+---------------+------------+\n</pre>\n\n<p><strong>解释：</strong></p>\n\n<ul>\n\t<li><strong>用户 1：</strong>\n\n\t<ul>\n\t\t<li>总提示词数 = 3</li>\n\t\t<li>平均词元数 = (120 + 80 + 200) / 3 = 133.33</li>\n\t\t<li>有一个提示词为 200 个词元，这超过了平均值</li>\n\t\t<li>包含在结果中</li>\n\t</ul>\n\t</li>\n\t<li><strong>用户 2</strong>:\n\t<ul>\n\t\t<li>总提示词数&nbsp;= 2（少于所需的最小值）</li>\n\t\t<li>从结果中排除</li>\n\t</ul>\n\t</li>\n\t<li><strong>用户 3</strong>:\n\t<ul>\n\t\t<li>总提示词数 = 4</li>\n\t\t<li>平均词元数 = (300 + 250 + 180 + 220) / 4 = 237.5</li>\n\t\t<li>有包含 300 和 250 个词元的提示词，都大于平均数</li>\n\t\t<li>包含在结果中</li>\n\t</ul>\n\t</li>\n</ul>\n\n<p>结果表按 avg_tokens 降序排序，然后按 user_id 升序排序。</p>\n</div>\n",
            "isPaidOnly": false,
            "difficulty": "Easy",
            "likes": 0,
            "dislikes": 0,
            "isLiked": null,
            "similarQuestions": "[]",
            "contributors": [],
            "langToValidPlayground": "{\"cpp\": false, \"java\": false, \"python3\": false, \"python\": false, \"javascript\": false, \"typescript\": false, \"csharp\": false, \"c\": false, \"golang\": false, \"kotlin\": false, \"swift\": false, \"rust\": false, \"ruby\": false, \"php\": false, \"dart\": false, \"scala\": false, \"elixir\": false, \"erlang\": false, \"racket\": false, \"cangjie\": false, \"bash\": false, \"html\": false, \"pythonml\": false, \"react\": false, \"vanillajs\": false, \"mysql\": false, \"mssql\": false, \"postgresql\": false, \"oraclesql\": false, \"pythondata\": false}",
            "topicTags": [],
            "companyTagStats": null,
            "codeSnippets": [
                {
                    "lang": "MySQL",
                    "langSlug": "mysql",
                    "code": "# Write your MySQL query statement below",
                    "__typename": "CodeSnippetNode"
                },
                {
                    "lang": "MS SQL Server",
                    "langSlug": "mssql",
                    "code": "/* Write your T-SQL query statement below */",
                    "__typename": "CodeSnippetNode"
                },
                {
                    "lang": "PostgreSQL",
                    "langSlug": "postgresql",
                    "code": "-- Write your PostgreSQL query statement below",
                    "__typename": "CodeSnippetNode"
                },
                {
                    "lang": "Oracle",
                    "langSlug": "oraclesql",
                    "code": "/* Write your PL/SQL query statement below */",
                    "__typename": "CodeSnippetNode"
                },
                {
                    "lang": "Pandas",
                    "langSlug": "pythondata",
                    "code": "import pandas as pd\n\ndef find_users_with_high_tokens(prompts: pd.DataFrame) -> pd.DataFrame:\n    ",
                    "__typename": "CodeSnippetNode"
                }
            ],
            "stats": "{\"totalAccepted\": \"214\", \"totalSubmission\": \"329\", \"totalAcceptedRaw\": 214, \"totalSubmissionRaw\": 329, \"acRate\": \"65.0%\"}",
            "hints": [],
            "solution": null,
            "status": null,
            "sampleTestCase": "{\"headers\":{\"prompts\":[\"user_id\",\"prompt\",\"tokens\"]},\"rows\":{\"prompts\":[[1,\"Write a blog outline\",120],[1,\"Generate SQL query\",80],[1,\"Summarize an article\",200],[2,\"Create resume bullet\",60],[2,\"Improve LinkedIn bio\",70],[3,\"Explain neural networks\",300],[3,\"Generate interview Q&A\",250],[3,\"Write cover letter\",180],[3,\"Optimize Python code\",220]]}}",
            "metaData": "{\"mysql\":[\"CREATE TABLE if not exists prompts (\\n    user_id INT,\\n    prompt VARCHAR(255),\\n    tokens INT\\n)\\n\"],\"mssql\":[\"CREATE TABLE prompts (\\n    user_id INT,\\n    prompt VARCHAR(255),\\n    tokens INT\\n)\"],\"oraclesql\":[\"CREATE TABLE prompts (\\n    user_id NUMBER,\\n    prompt VARCHAR2(255),\\n    tokens NUMBER\\n)\"],\"database\":true,\"name\":\"find_users_with_high_tokens\",\"postgresql\":[\"CREATE TABLE prompts (\\n    user_id INT,\\n    prompt VARCHAR(255),\\n    tokens INT\\n)\"],\"pythondata\":[\"prompts = pd.DataFrame({\\n    \\\"user_id\\\": pd.Series(dtype=\\\"int\\\"),\\n    \\\"prompt\\\": pd.Series(dtype=\\\"string\\\"),\\n    \\\"tokens\\\": pd.Series(dtype=\\\"int\\\")\\n})\\n\"],\"database_schema\":{\"prompts\":{\"user_id\":\"INT\",\"prompt\":\"VARCHAR(255)\",\"tokens\":\"INT\"}}}",
            "judgerAvailable": true,
            "judgeType": "large",
            "mysqlSchemas": [
                "CREATE TABLE if not exists prompts (\n    user_id INT,\n    prompt VARCHAR(255),\n    tokens INT\n)\n",
                "Truncate table prompts",
                "insert into prompts (user_id, prompt, tokens) values ('1', 'Write a blog outline', '120')",
                "insert into prompts (user_id, prompt, tokens) values ('1', 'Generate SQL query', '80')",
                "insert into prompts (user_id, prompt, tokens) values ('1', 'Summarize an article', '200')",
                "insert into prompts (user_id, prompt, tokens) values ('2', 'Create resume bullet', '60')",
                "insert into prompts (user_id, prompt, tokens) values ('2', 'Improve LinkedIn bio', '70')",
                "insert into prompts (user_id, prompt, tokens) values ('3', 'Explain neural networks', '300')",
                "insert into prompts (user_id, prompt, tokens) values ('3', 'Generate interview Q&A', '250')",
                "insert into prompts (user_id, prompt, tokens) values ('3', 'Write cover letter', '180')",
                "insert into prompts (user_id, prompt, tokens) values ('3', 'Optimize Python code', '220')"
            ],
            "enableRunCode": true,
            "envInfo": "{\"mysql\":[\"MySQL\",\"<p>\\u7248\\u672c\\uff1a<code>MySQL 8.0<\\/code><\\/p>\\r\\n\\r\\n<p>\\u6ce8\\u610f\\uff1a\\u56e0\\u4e3a\\u5386\\u53f2\\u539f\\u56e0\\uff0c\\u6211\\u4eec\\u6ca1\\u6709\\u542f\\u7528\\u4efb\\u4f55 SQL \\u6a21\\u5f0f\\uff0c\\u5305\\u62ec <code>ONLY_FULL_GROUP_BY<\\/code>, <code>STRICT_TRANS_TABLES<\\/code>, <code>NO_ZERO_IN_DATE<\\/code>, <code>NO_ZERO_DATE<\\/code>, <code>ERROR_FOR_DIVISION_BY_ZERO<\\/code> \\u7b49\\u3002<\\/p>\"],\"mssql\":[\"MS SQL Server\",\"<p>mssql server 2019.<\\/p>\"],\"oraclesql\":[\"Oracle\",\"<p>Oracle Sql 11.2.<\\/p>\"],\"pythondata\":[\"Pandas\",\"<p>Python 3.10 with Pandas 2.2.2 and NumPy 1.26.4<\\/p>\"],\"postgresql\":[\"PostgreSQL\",\"<p>PostgreSQL 16<\\/p>\"]}",
            "book": null,
            "isSubscribed": false,
            "isDailyQuestion": false,
            "dailyRecordStatus": null,
            "editorType": "CKEDITOR",
            "ugcQuestionId": null,
            "style": "LEETCODE",
            "exampleTestcases": "{\"headers\":{\"prompts\":[\"user_id\",\"prompt\",\"tokens\"]},\"rows\":{\"prompts\":[[1,\"Write a blog outline\",120],[1,\"Generate SQL query\",80],[1,\"Summarize an article\",200],[2,\"Create resume bullet\",60],[2,\"Improve LinkedIn bio\",70],[3,\"Explain neural networks\",300],[3,\"Generate interview Q&A\",250],[3,\"Write cover letter\",180],[3,\"Optimize Python code\",220]]}}",
            "__typename": "QuestionNode"
        }
    }
}